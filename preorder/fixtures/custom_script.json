[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Purchase Invoice", 
  "modified": "2018-01-31 11:30:56.307755", 
  "name": "Purchase Invoice-Client", 
  "script": "frappe.ui.form.on(\"Purchase Invoice\", {\n\trefresh: function() {\n\t},\n\trefresh: function(frm){\n\t\tfrm.events.set_total_purchase_receipt(frm);\n//\t\tfrm.events.set_total_related_invoice(frm);\n\t},\n\tvalidate: function(frm){\n\t\tfrm.events.set_total_purchase_receipt(frm);\n\t\tfrm.events.set_total_related_invoice(frm);\n\t\tfrm.events.validate_percentage(frm);\n\t\tfrm.events.validate_adjustment_tax(frm);\n\t\tfrm.events.validate_get_items(frm);\n\t\tfrm.events.validate_get_items2(frm);\n\t\tfrm.events.validate_return(frm);\n\t},\n\ttype_of_invoice: function(frm){\n\t\tfrm.set_value(\"count_get_items\", \"0\");\n\t\tfrm.set_value(\"count_get_items2\", \"0\");\n\t\tif(frm.doc.type_of_invoice == \"Termin Payment\"){\n\t\t\tfrm.clear_table(\"receipt\");\n\t\t\tif(!frm.doc.supplier || !frm.doc.purchase_order) return;\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: 'preorder.preorder.purchase.get_purchase_receipt',\n\t\t\t\targs: {\n\t\t\t\t\tsupplier: frm.doc.supplier,\n\t\t\t\t\tpo: frm.doc.purchase_order\n\t\t\t\t},\n\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t$.each(r.message, function(i, d) {\n\t\t\t\t\t\t\tvar c = frm.add_child(\"receipt\");\n\t\t\t\t\t\t\tc.purchase_receipt = d.purchase_receipt;\n\t\t\t\t\t\t\tc.posting_date = d.posting_date;\n\t\t\t\t\t\t\tc.total = d.total;\n\t\t\t\t\t\t\tc.net_total = d.net_total;\n\t\t\t\t\t\t\tc.base_total = d.base_total;\n\t\t\t\t\t\t\tc.base_net_total = d.base_net_total;\n\t\t\t\t\t\t})\n\t\t\t\t\t\tfrm.fields_dict.base_total_purchase_receipt.set_label('Total Purchase Receipt (IDR)');\n\t\t\t\t\t\tfrm.fields_dict.total_purchase_receipt.set_label('Total Purchase Receipt ('+frm.doc.currency+')');\n\t\t\t\t\t\tfrm.refresh_fields();\n\t\t\t\t\t\tfrm.events.set_total_purchase_receipt(frm);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}else if(frm.doc.type_of_invoice == \"Retention\" || frm.doc.type_of_invoice == \"Non Project Payment\"){\n\t\t\tfrm.clear_table(\"related\");\n\t\t\tif(!frm.doc.supplier || !frm.doc.purchase_order) return;\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: 'preorder.preorder.purchase.get_purchase_invoice',\n\t\t\t\targs: {\n\t\t\t\t\tsupplier: frm.doc.supplier,\n\t\t\t\t\tpo: frm.doc.purchase_order,\n\t\t\t\t\tinvoice_type: frm.doc.type_of_invoice,\n\t\t\t\t\tnet_total: frm.doc.net_total,\n\t\t\t\t\tbase_net_total: frm.doc.base_net_total\n\t\t\t\t},\n\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t$.each(r.message, function(i, d) {\n\t\t\t\t\t\t\tvar c = frm.add_child(\"related\");\n\t\t\t\t\t\t\tc.purchase_invoice = d.purchase_invoice;\n\t\t\t\t\t\t\tc.posting_date = d.posting_date;\n\t\t\t\t\t\t\tc.base_total = d.base_total;\n\t\t\t\t\t\t\tc.base_net_total = d.base_net_total;\n\t\t\t\t\t\t\tc.total = d.total;\n\t\t\t\t\t\t\tc.net_total = d.net_total;\n\t\t\t\t\t\t})\n\t\t\t\t\t\tfrm.fields_dict.base_total_purchase_receipt.set_label('Total Purchase Receipt ('+frm.doc.party_account_currency+')');\n\t\t\t\t\t\tfrm.fields_dict.total_purchase_receipt.set_label('Total Purchase Receipt ('+frm.doc.currency+')');\n\t\t\t\t\t\tfrm.refresh_fields();\n\t\t\t\t\t\tfrm.events.set_total_related_invoice(frm);\n\t\t\t\t\t\tfrm.events.buying_write_off(frm);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\tbuying_write_off: function(frm){\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.client.get\",\n\t\t\targs: {\n\t\t\t\tdoctype: \"Item Settings\",\n\t\t\t},\n\t\t\tcallback: function (data) {\n\t\t\t\tfrm.set_value(\"write_off_account\", data.message.buying_write_off_account);\n\t\t\t}\n\t\t})\n\t},\n\tget_items2: function(frm){\n\t\tif(frm.doc.type_of_invoice == \"Termin Payment\"){\n\t\t\tfrm.set_value(\"count_get_items2\", \"1\");\n\t\t\tfrm.clear_table(\"items\");\n\t\t\tif(!frm.doc.supplier) return;\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: 'preorder.preorder.purchase.get_items_payment',\n\t\t\t\targs: {\n\t\t\t\t\tsupplier: frm.doc.supplier\n\t\t\t\t},\n\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t$.each(r.message, function(i, d) {\n\t\t\t\t\t\t\tvar c = frm.add_child(\"items\");\n\t\t\t\t\t\t\tc.item_code = d.item_code;\n\t\t\t\t\t\t\tc.item_name = d.item_name;\n\t\t\t\t\t\t\tc.description = d.description;\n\t\t\t\t\t\t\tc.uom = d.uom;\n\t\t\t\t\t\t\tc.stock_uom = d.stock_uom;\n\t\t\t\t\t\t\tc.qty = d.qty;\n\t\t\t\t\t\t\tc.expense_account = d.expense_account;\n\t\t\t\t\t\t\tc.rate = flt(frm.doc.total_purchase_receipt) * (flt(frm.doc.percentage_of_payment)/100);\n\t\t\t\t\t\t\tc.amount = flt(frm.doc.total_purchase_receipt) * (flt(frm.doc.percentage_of_payment)/100);\n\t\t\t\t\t\t})\n\t\t\t\t\t\tfrm.refresh_fields();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\tpercentage_of_payment: function(frm){\n\t\tfrm.events.set_total_purchase_receipt(frm);\n\t},\n\trefresh_total_pr: function(frm){\n\t\tfrm.events.set_total_purchase_receipt(frm);\n\t},\n\tset_total_purchase_receipt: function(frm) {\n\t\tvar total_pr = 0.0;\n\t\tvar base_total_pr = 0.0;\n\t\t$.each(frm.doc.receipt, function(i, row) {\n\t\t\ttotal_pr += flt(row.total);\n\t\t\tbase_total_pr += flt(row.base_total);\n\t\t})\n\t\tfrm.set_value(\"total_purchase_receipt\", Math.abs(total_pr));\n\t\tfrm.set_value(\"base_total_purchase_receipt\", Math.abs(base_total_pr));\n\t},\n\tset_total_related_invoice: function(frm) {\n\t\tvar total_pi = 0.0;\n\t\tvar base_total_pi = 0.0;\n\t\t$.each(frm.doc.related, function(i, row) {\n\t\t\ttotal_pi += flt(row.net_total);\n\t\t\tbase_total_pi += flt(row.base_net_total);\n\t\t})\n\t\tfrm.set_value(\"total_related_invoices\", Math.abs(total_pi));\n\t\tfrm.set_value(\"base_total_related_invoices\", Math.abs(base_total_pi));\n\t\tfrm.set_value(\"write_off_amount\", Math.abs(total_pi));\n\t},\n\tvalidate_percentage: function(frm){\n\t\tif(frm.doc.type_of_invoice == \"Down Payment\" || frm.doc.type_of_invoice == \"Progress Payment\" || frm.doc.type_of_invoice == \"Termin Payment\"){\n\t\t\tif(flt(frm.doc.percentage_of_payment) >= 100 || flt(frm.doc.percentage_of_payment) <= 0){\n\t\t\t\tmsgprint(\"Percentage should not be greater than 100 or less than 0\");\n\t\t\t\tvalidated = false;\n\t\t\t}\n\t\t}\n\t},\n\tvalidate_adjustment_tax: function(frm){\n\t\tif(frm.doc.total_taxes_and_charges != 0){\n\t\t\tif(frm.doc.type_of_invoice == \"Retention\" || frm.doc.type_of_invoice == \"Non Project Payment\"){\n\t\t\t\tif(frm.doc.adjustment_count == 0){\n\t\t\t\t\tmsgprint(\"You have not clicked 'Adjust Taxes and Charges'\");\n\t\t\t\t\tvalidated = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tvalidate_get_items: function(frm){\n\t\tif(frm.doc.type_of_invoice == \"Down Payment\" || frm.doc.type_of_invoice == \"Progress Payment\"){\n\t\t\tif(frm.doc.count_get_items == 0){\n\t\t\t\tmsgprint(\"You have not clicked 'Get Items'\");\n\t\t\t\tvalidated = false;\n\t\t\t}\n\t\t}\n\t},\n\tvalidate_get_items2: function(frm){\n\t\tif(frm.doc.type_of_invoice == \"Termin Payment\"){\n\t\t\tif(frm.doc.count_get_items2 == 0){\n\t\t\t\tmsgprint(\"You have not clicked 'Get Items'\");\n\t\t\t\tvalidated = false;\n\t\t\t}\n\t\t}\n\t},\n\tadjust_taxes_and_charges: function(frm, cdt, cdn) {\n\t\tvar tbl = frm.doc.taxes || [];\n\t\tvar i = tbl.length;\n\t\twhile (i--) {\n\t\t\tif(frm.doc.taxes[i].charge_type != \"Actual\"){\n\t\t\t\tvar selisih = flt(frm.doc.net_total) - flt(frm.doc.write_off_amount);\n\t\t\t\tvar actual = (flt(frm.doc.taxes[i].tax_amount)/flt(frm.doc.net_total)) * selisih;\n\t\t\t\tfrm.doc.taxes[i].tax_amount = Math.abs(actual);\n\t\t\t\tfrm.doc.taxes[i].charge_type = \"Actual\";\n\t\t\t\tfrm.refresh_field(\"taxes\");\n\t\t\t}\n\t\t}\n\t\tfrm.set_value(\"adjustment_count\", \"1\");\n\t},\n\tget_items: function(frm){\n\t\tfrm.set_value(\"count_get_items\", \"1\");\n\t\tfrm.clear_table(\"items\");\n\t\tif(frm.doc.type_of_invoice == \"Down Payment\"){\n\t\t\tvar jenis = frm.doc.purchase_order;\n\t\t\tif(!frm.doc.purchase_order) return;\n\t\t}else if(frm.doc.type_of_invoice == \"Progress Payment\"){\n\t\t\tvar jenis = frm.doc.purchase_receipt;\n\t\t\tif(!frm.doc.purchase_receipt) return;\n\t\t}\n\t\treturn frappe.call({\n\t\t\tmethod: 'preorder.preorder.purchase.get_po_items',\n\t\t\targs: {\n\t\t\t\ttipe: frm.doc.type_of_invoice,\n\t\t\t\trelated_doc: jenis,\n\t\t\t\tpercen: frm.doc.percentage_of_payment\n\t\t\t},\n\t\t\tcallback: function(r, rt) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\t$.each(r.message, function(i, d) {\n\t\t\t\t\t\tvar c = frm.add_child(\"items\");\n\t\t\t\t\t\tc.item_code = d.item_code;\n\t\t\t\t\t\tc.item_name = d.item_name;\n\t\t\t\t\t\tc.description = d.description;\n\t\t\t\t\t\tc.qty = d.qty;\n\t\t\t\t\t\tc.uom = d.uom;\n\t\t\t\t\t\tc.rate = d.rate;\n\t\t\t\t\t\tc.amount = d.amount;\n\t\t\t\t\t\tc.expense_account = d.expense_account;\n\t\t\t\t\t})\n\t\t\t\t\tfrm.refresh_fields();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\tmultilevel_discount_percentage: function(frm){\n    \t\tif(frm.doc.multilevel_discount_percentage) {\n        \t\tvar stringsearch = \"+\",str = frm.doc.multilevel_discount_percentage;\n        \t\tfor(var i=count=0; i<str.length; count+=+(stringsearch===str[i++]));\n        \t\tif(count >= 1){\n        \t    \t\tbanyak = count;\n\t\t\t\tvar parts = frm.doc.multilevel_discount_percentage;\n        \t    \t\tvar arr = parts.split('+');\n        \t    \t\tdisco = 100 - ((arr[0]/100) * 100);\n        \t    \t\tfor(nn=1; nn<=banyak; nn++){\n       \t         \t\t\tdisco = disco - ((arr[nn]/100) * disco);\n       \t     \t\t\t}\n        \t    \t\tsisa = 100 - disco;\n        \t\t}else{\n        \t    \t\tsisa = flt(frm.doc.multilevel_discount_percentage);\n        \t\t}\n        \t\tfrm.set_value(\"additional_discount_percentage\", sisa);\n    \t\t}else{\n        \t\tfrm.set_value(\"additional_discount_percentage\", \"\");\n    \t\t}\n\t},\n\tvalidate_return: function(frm){\n\t\tif(frm.doc.is_return == '1'){\n\t\t\tmsgprint(\"You can not make a purchase return from here\");\n\t\t\tvalidated = false;\n\t\t}\n\t}\n});\ncur_frm.set_query(\"purchase_order\",  function (frm) {\n\treturn {\n        \tfilters: [\n            \t\t['supplier', '=', cur_frm.doc.supplier],\n            \t\t['docstatus', '=', '1'],\n\t\t\t['status', 'in', 'To Receive and Bill']\n        \t],\n\t}\n});\ncur_frm.set_query(\"purchase_receipt\",  function (frm) {\n\treturn {\n        \tfilters: [\n            \t\t['supplier', '=', cur_frm.doc.supplier],\n            \t\t['docstatus', '=', '1'],\n\t\t\t['status', 'in', 'To Bill']\n        \t],\n\t}\n});\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Quotation", 
  "modified": "2017-12-15 15:10:29.881344", 
  "name": "Quotation-Client", 
  "script": "frappe.ui.form.on(\"Quotation\", {\n\trefresh: function(frm){\n\t\tcur_frm.add_custom_button(__(\"Inquiry\"), function() {\n\t\t\terpnext.utils.map_current_doc({\n\t\t\t\tmethod: \"preorder.preorder.lemparan.get_items_selling_quotation\",\n\t\t\t\tsource_doctype: \"Inquiry\",\n\t\t\t\ttarget: cur_frm,\n\t\t\t\tsetters: {\n\t\t\t\t\tcustomer: cur_frm.doc.customer || undefined,\n\t\t\t\t},\n\t\t\t\tget_query_filters: {\n\t\t\t\t\tdocstatus: 1,\n\t\t\t\t\tstatus: \"Submitted\",\n\t\t\t\t\tcompany: cur_frm.doc.company,\n\t\t\t\t}\n\t\t\t})\n\t\t}, __(\"Get items from\"));\n\t\tif(frm.doc.docstatus == 1 && frm.doc.status!=='Lost' && frm.doc.so_status != \"Completed\") {\n\t\t\tif(!frm.doc.valid_till || frappe.datetime.get_diff(frm.doc.valid_till, frappe.datetime.get_today()) > 0) {\n\t\t\t\tcur_frm.add_custom_button(__('Sales Order'),\n\t\t\t\t\tcur_frm.cscript['Make Sales Order'], __(\"Make\"));\n\t\t\t}\n\t\t\tcur_frm.page.set_inner_btn_group_as_primary(__(\"Make\"));\n\t\t}\n\t\tfrm.clear_custom_button();\n\t},\n\tget_items: function(frm){\n\t\terpnext.utils.map_current_doc({\n\t\t\tmethod: \"preorder.preorder.lemparan.get_items_selling_quotation\",\n\t\t\tsource_name: cur_frm.doc.inquiry,\n\t\t});\n\t},\n\tvalidate: function(frm){\n\t\t$.each(frm.doc.items, function(i, d) {\n\t\t\tif(d.rate == 0 && d.alternative_item == 1){\t\t\n\t\t\t\tmsgprint(\"Item No.\"+d.idx+\", rate is still zero\");\n\t\t\t\tvalidated = false;\n\t\t\t}\n\t\t\td.quotation_rate = Math.abs(d.rate);\n\t\t});\n\t\tfrm.events.calculate_assembly_qty(frm);\n\t\t//calculate_multilevel_discount(frm);\n\t\t//beda_diskon_amount(frm);\n\t},\n\tcalculate_assembly_qty: function(frm){\n\t\t$.each(frm.doc.items, function(i, d) {\n\t\t\tif(d.is_product_assembly == '1'){\n\t\t\t\t$.each(frm.doc.assembly_item, function(i, e) {\n\t\t\t\t\tif(e.parent_item == d.item_description){\n\t\t\t\t\t\te.qty = e.base_qty * d.qty;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t},\n\tmultilevel_discount_percentage: function(frm){\n    \t\tif(frm.doc.multilevel_discount_percentage) {\n        \t\tvar stringsearch = \"+\",str = frm.doc.multilevel_discount_percentage;\n        \t\tfor(var i=count=0; i<str.length; count+=+(stringsearch===str[i++]));\n        \t\tif(count >= 1){\n        \t    \t\tbanyak = count;\n\t\t\t\tvar parts = frm.doc.multilevel_discount_percentage;\n        \t    \t\tvar arr = parts.split('+');\n        \t    \t\tdisco = 100 - ((arr[0]/100) * 100);\n        \t    \t\tfor(nn=1; nn<=banyak; nn++){\n       \t         \t\t\tdisco = disco - ((arr[nn]/100) * disco);\n       \t     \t\t\t}\n        \t    \t\tsisa = 100 - disco;\n        \t\t}else{\n        \t    \t\tsisa = flt(frm.doc.multilevel_discount_percentage);\n        \t\t}\n        \t\tfrm.set_value(\"additional_discount_percentage\", sisa);\n    \t\t}else{\n        \t\tfrm.set_value(\"additional_discount_percentage\", \"\");\n    \t\t}\n\t},\n})\ncur_frm.cscript['Make Sales Order'] = function() {\n\tfrappe.model.open_mapped_doc({\n\t\tmethod: \"preorder.preorder.selling.make_sales_order\",\n\t\tfrm: cur_frm\n\t})\n}\ncur_frm.set_query(\"inquiry\", function(frm) {\n    return {\n        filters: {\n\t    'customer': cur_frm.doc.customer || undefined,\n\t    'docstatus': 1,\n\t    'quotation': '',\n\t    'status': [\"not in\", \"Lost, Completed\"]\n\t},\n    }\n});\n/*\nvar calculate_multilevel_discount = function(frm) {\n    var diskon1 = frm.doc.discount_1;\n    var diskon2 = frm.doc.discount_2;\n    var diskon3 = frm.doc.discount_3;\n    var diskon1_amt = ((100 - diskon1)/100) * 100;\n    var diskon2_amt = ((100 - diskon2)/100) * diskon1_amt;\n    var diskon3_amt = ((100 - diskon3)/100) * diskon2_amt;\n    var total_diskon = 100 - diskon3_amt;\n    var diskon1_amount = (diskon1/100) * frm.doc.total;\n    var amount_after1 = frm.doc.total - diskon1_amount;\n    var diskon2_amount = (diskon2/100) * amount_after1;\n    var amount_after2 = amount_after1 - diskon2_amount;\n    var diskon3_amount = (diskon3/100) * amount_after2;\n    var amount_after3 = amount_after2 - diskon3_amount;\n    frm.set_value(\"discount_1_amount\", diskon1_amount);\n    frm.set_value(\"amount_after_discount_1\", amount_after1);\n    frm.set_value(\"discount_2_amount\", diskon2_amount);\n    frm.set_value(\"amount_after_discount_2\", amount_after2);\n    frm.set_value(\"discount_3_amount\", diskon3_amount);\n    frm.set_value(\"amount_after_discount_3\", amount_after3);\n    frm.set_value(\"additional_discount_percentage\", total_diskon);\n    frm.set_value(\"total_discount_percentage\", total_diskon);\n    var aa = (total_diskon/100) * frm.doc.total;\n    frm.set_value(\"total_discount_amount\", aa);\n}\nfrappe.ui.form.on(\"Quotation\", \"discount_1\", function(frm) {\n    calculate_multilevel_discount(frm);\n})\nfrappe.ui.form.on(\"Quotation\", \"discount_2\", function(frm) {\n    calculate_multilevel_discount(frm);\n})\nfrappe.ui.form.on(\"Quotation\", \"discount_3\", function(frm) {\n    calculate_multilevel_discount(frm);\n})\nfrappe.ui.form.on(\"Quotation\", \"net_total\", function(frm) {\n    calculate_multilevel_discount(frm);\n})\nvar beda_diskon_amount = function(frm){\n    var total_diskon_persen = frm.doc.total_discount_percentage;\n    var total_diskon_amount = (total_diskon_persen/100) * frm.doc.total;\n    if(total_diskon_amount != frm.doc.total_discount_amount){\n\tfrm.set_value(\"total_discount_percentage\", \"0\");\n\tfrm.set_value(\"discount_amount\", frm.doc.total_discount_amount);\n    }\n}\nfrappe.ui.form.on(\"Quotation\", \"total_discount_amount\", function(frm) {\n    beda_diskon_amount(frm);\n})\n*/\nfrappe.ui.form.on(\"Quotation Item\", \"item_description\", function(frm, cdt, cdn) {\n\trow = locals[cdt][cdn];\n\tfrappe.call({\n\t\tmethod: \"frappe.client.get\",\n\t\targs: {\n\t\t\tdoctype: \"Item Settings\",\n\t\t},\n\t\tcallback: function (data) {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"item_code\", data.message.default_item_for_inquiry);\n\t\t}\n\t})\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2018-04-23 15:22:30.984714", 
  "name": "Sales Invoice-Client", 
  "script": "frappe.ui.form.on(\"Sales Invoice\", {\n\trefresh: function() {\n\t\tcur_frm.add_custom_button(__(\"Inquiry\"), function() {\n\t\t\terpnext.utils.map_current_doc({\n\t\t\t\tmethod: \"erpnext.selling.doctype.sales_order.sales_order.make_delivery_note\",\n\t\t\t\tsource_doctype: \"Inquiry\",\n\t\t\t\ttarget: cur_frm,\n\t\t\t\tsetters: {\n\t\t\t\t\tcustomer: cur_frm.doc.customer || undefined,\n\t\t\t\t},\n\t\t\t\tget_query_filters: {\n\t\t\t\t\tdocstatus: 1,\n\t\t\t\t\tcompany: cur_frm.doc.company,\n\t\t\t\t}\n\t\t\t})\n\t\t}, __(\"Get items from\"));\n\t},\n\trefresh: function(frm){\n\t\tfrm.events.set_total_delivery_note(frm);\n//\t\tfrm.events.set_total_related_invoice(frm);\n\t},\n\tvalidate: function(frm){\n\t\tfrm.events.validate_po_no(frm);\n\t\tfrm.events.set_total_delivery_note(frm);\n\t\tfrm.events.set_total_related_invoice(frm);\n\t\tfrm.events.validate_percentage(frm);\n\t\tfrm.events.validate_adjustment_tax(frm);\n\t\tfrm.events.validate_get_items2(frm);\n\t\tfrm.events.validate_return(frm);\n\t\tfrm.events.validate_tt_advanced(frm);\n\t},\n\ttype_of_invoice: function(frm){\n\t\tif(frm.doc.type_of_invoice == \"Termin Payment\"){\n\t\t\tfrm.set_value(\"count_get_items2\", \"0\");\n\t\t\tfrm.clear_table(\"delivery\");\n\t\t\tif(!frm.doc.sales_order) return;\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: 'preorder.preorder.lemparan.get_delivery_note',\n\t\t\t\targs: {\n\t\t\t\t\tsales_order: frm.doc.sales_order\n\t\t\t\t},\n\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t$.each(r.message, function(i, d) {\n\t\t\t\t\t\t\tvar c = frm.add_child(\"delivery\");\n\t\t\t\t\t\t\tc.delivery_note = d.delivery_note;\n\t\t\t\t\t\t\tc.posting_date = d.posting_date;\n\t\t\t\t\t\t\tc.total = d.total;\n\t\t\t\t\t\t\tc.net_total = d.net_total;\n\t\t\t\t\t\t})\n\t\t\t\t\t\tfrm.refresh_fields();\n\t\t\t\t\t\tfrm.events.set_total_delivery_note(frm);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}else if(frm.doc.type_of_invoice == \"Retention\"){\n\t\t\tfrm.clear_table(\"related\");\n\t\t\tif(!frm.doc.sales_order) return;\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: 'preorder.preorder.lemparan.get_sales_invoice',\n\t\t\t\targs: {\n\t\t\t\t\tsales_order: frm.doc.sales_order,\n\t\t\t\t\ttipe: frm.doc.type_of_invoice\n\t\t\t\t},\n\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t$.each(r.message, function(i, d) {\n\t\t\t\t\t\t\tvar c = frm.add_child(\"related\");\n\t\t\t\t\t\t\tc.sales_invoice = d.sales_invoice;\n\t\t\t\t\t\t\tc.posting_date = d.posting_date;\n\t\t\t\t\t\t\tc.total = d.total;\n\t\t\t\t\t\t\tc.net_total = d.net_total;\n\t\t\t\t\t\t})\n\t\t\t\t\t\tfrm.refresh_fields();\n\t\t\t\t\t\tfrm.events.set_total_related_invoice(frm);\n\t\t\t\t\t\tfrm.events.selling_write_off(frm);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}else if(frm.doc.type_of_invoice == \"Non Project Payment\"){\n\t\t\tfrm.clear_table(\"related\");\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: 'preorder.preorder.lemparan.get_sales_invoice2',\n\t\t\t\targs: {\n\t\t\t\t\tsales_order: frm.doc.sales_order || \"none\",\n\t\t\t\t\tdelivery: frm.doc.delivery_note || \"none\",\n\t\t\t\t\ttipe: frm.doc.type_of_invoice,\n\t\t\t\t\ttotal: frm.doc.net_total\n\t\t\t\t},\n\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t$.each(r.message, function(i, d) {\n\t\t\t\t\t\t\tvar c = frm.add_child(\"related\");\n\t\t\t\t\t\t\tc.sales_invoice = d.sales_invoice;\n\t\t\t\t\t\t\tc.posting_date = d.posting_date;\n\t\t\t\t\t\t\tc.total = d.total;\n\t\t\t\t\t\t\tc.net_total = d.net_total;\n\t\t\t\t\t\t})\n\t\t\t\t\t\tfrm.refresh_fields();\n\t\t\t\t\t\tfrm.events.set_total_related_invoice(frm);\n\t\t\t\t\t\tfrm.events.selling_write_off(frm);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\tselling_write_off: function(frm){\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.client.get\",\n\t\t\targs: {\n\t\t\t\tdoctype: \"Item Settings\",\n\t\t\t},\n\t\t\tcallback: function (data) {\n\t\t\t\tfrm.set_value(\"write_off_account\", data.message.selling_write_off_account);\n\t\t\t}\n\t\t})\n\t},\n\tvalidate_po_no: function(frm){\n\t\tif(!frm.doc.po_no){\n\t\t\t\tmsgprint(\"Customer's PO must be filled in Sales Order\");\n\t\t\t\tvalidated = false;\n\t\t}\n\t},\n\tvalidate_percentage: function(frm){\n\t\tif(frm.doc.type_of_invoice == \"Down Payment\" || frm.doc.type_of_invoice == \"Progress Payment\" || frm.doc.type_of_invoice == \"Payment\"){\n\t\t\tif(flt(frm.doc.percentage_dp) >= 100 || flt(frm.doc.percentage_dp) <= 0){\n\t\t\t\tmsgprint(\"Percentage should not be greater than 100 or less than 0\");\n\t\t\t\tvalidated = false;\n\t\t\t}\n\t\t}\n\t},\n\tvalidate_adjustment_tax: function(frm){\n\t\tif(frm.doc.total_taxes_and_charges != 0){\n\t\t\tif(frm.doc.type_of_invoice == \"Retention\" || frm.doc.type_of_invoice == \"Non Project Payment\"){\n\t\t\t\tif(frm.doc.adjustment_count == 0){\n\t\t\t\t\tmsgprint(\"You have not clicked 'Adjust Taxes and Charges'\");\n\t\t\t\t\tvalidated = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tvalidate_get_items2: function(frm){\n\t\tif(frm.doc.type_of_invoice == \"Termin Payment\"){\n\t\t\tif(frm.doc.count_get_items2 == 0){\n\t\t\t\tmsgprint(\"You have not clicked 'Get Items'\");\n\t\t\t\tvalidated = false;\n\t\t\t}\n\t\t}\n\t},\n\tpercentage_dp: function(frm){\n\t\tfrm.events.set_total_delivery_note(frm);\n\t},\n\tset_total_delivery_note: function(frm) {\n\t\tvar total_dn = 0.0;\n\t\t$.each(frm.doc.delivery, function(i, row) {\n\t\t\ttotal_dn += flt(row.total);\n\t\t})\n\t\tfrm.set_value(\"total_delivery_note\", Math.abs(total_dn));\n\t},\n\tset_total_related_invoice: function(frm) {\n\t\tvar total_si = 0.0;\n\t\t$.each(frm.doc.related, function(i, row) {\n\t\t\ttotal_si += flt(row.net_total);\n\t\t})\n\t\tfrm.set_value(\"total_related_invoices\", Math.abs(total_si));\n\t\tfrm.set_value(\"write_off_amount\", Math.abs(total_si));\n\t},\n\tadjust_taxes_and_charges: function(frm, cdt, cdn) {\n\t\tvar tbl = frm.doc.taxes || [];\n\t\tvar i = tbl.length;\n\t\twhile (i--) {\n\t\t\tif(frm.doc.taxes[i].charge_type != \"Actual\"){\n\t\t\t\tvar selisih = flt(frm.doc.net_total) - flt(frm.doc.write_off_amount);\n\t\t\t\tvar actual = (flt(frm.doc.taxes[i].tax_amount)/flt(frm.doc.net_total)) * selisih;\n\t\t\t\tfrm.doc.taxes[i].tax_amount = Math.abs(actual);\n\t\t\t\tfrm.doc.taxes[i].charge_type = \"Actual\";\n\t\t\t\tfrm.refresh_field(\"taxes\");\n\t\t\t}\n\t\t}\n\t\tfrm.set_value(\"adjustment_count\", \"1\");\n\t},\n\tget_items: function(frm){\n\t\tfrm.set_value(\"get_items_count\", \"1\");\n\t\tfrm.clear_table(\"items\");\n\t\tif(frm.doc.type_of_invoice == \"Down Payment\"){\n\t\t\tvar jenis = frm.doc.sales_order\n\t\t}else if(frm.doc.type_of_invoice == \"Progress Payment\"){\n\t\t\tvar jenis = frm.doc.delivery_note\n\t\t}\n\t\treturn frappe.call({\n\t\t\tmethod: 'preorder.preorder.lemparan.get_items_tampungan',\n\t\t\targs: {\n\t\t\t\trelated_doc: jenis,\n\t\t\t\ttipe: frm.doc.type_of_invoice,\n\t\t\t\tpercen: frm.doc.percentage_dp\n\t\t\t},\n\t\t\tcallback: function(r, rt) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\t$.each(r.message, function(i, d) {\n\t\t\t\t\t\tvar c = frm.add_child(\"items\");\n\t\t\t\t\t\tc.item_code = d.item_code;\n\t\t\t\t\t\tc.item_name = d.item_name;\n\t\t\t\t\t\tc.description = d.description;\n\t\t\t\t\t\tc.qty = d.qty;\n\t\t\t\t\t\tc.uom = d.uom;\n\t\t\t\t\t\tc.rate = d.rate;\n\t\t\t\t\t\tc.amount = d.amount;\n\t\t\t\t\t\tc.income_account = d.income_account;\n\t\t\t\t\t\tc.expense_account = d.expense_account;\n\t\t\t\t\t})\n\t\t\t\t\tfrm.refresh_fields();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\tget_items2: function(frm){\n\t\tfrm.events.set_total_delivery_note(frm);\n\t\tfrm.set_value(\"count_get_items2\", \"1\");\n\t\tfrm.clear_table(\"items\");\n\t\tif(!frm.doc.sales_order) return;\n\t\treturn frappe.call({\n\t\t\tmethod: 'preorder.preorder.lemparan.get_items_from_pelunasan',\n\t\t\targs: {\n\t\t\t\tsales_order: frm.doc.sales_order,\n\t\t\t\ttotal_delivery: frm.doc.total_delivery_note,\n\t\t\t\tpercen: frm.doc.percentage_dp\n\t\t\t},\n\t\t\tcallback: function(r, rt) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\t$.each(r.message, function(i, d) {\n\t\t\t\t\t\tvar c = frm.add_child(\"items\");\n\t\t\t\t\t\tc.item_code = d.item_code;\n\t\t\t\t\t\tc.item_name = d.item_name;\n\t\t\t\t\t\tc.description = d.description;\n\t\t\t\t\t\tc.qty = d.qty;\n\t\t\t\t\t\tc.uom = d.uom;\n\t\t\t\t\t\tc.rate = d.rate;\n\t\t\t\t\t\tc.amount = d.amount;\n\t\t\t\t\t\tc.income_account = d.income_account;\n\t\t\t\t\t\tc.expense_account = d.expense_account;\n\t\t\t\t\t})\n\t\t\t\t\tfrm.refresh_fields();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\tmultilevel_discount_percentage: function(frm){\n    \t\tif(frm.doc.multilevel_discount_percentage) {\n        \t\tvar stringsearch = \"+\",str = frm.doc.multilevel_discount_percentage;\n        \t\tfor(var i=count=0; i<str.length; count+=+(stringsearch===str[i++]));\n        \t\tif(count >= 1){\n        \t    \t\tbanyak = count;\n\t\t\t\tvar parts = frm.doc.multilevel_discount_percentage;\n        \t    \t\tvar arr = parts.split('+');\n        \t    \t\tdisco = 100 - ((arr[0]/100) * 100);\n        \t    \t\tfor(nn=1; nn<=banyak; nn++){\n       \t         \t\t\tdisco = disco - ((arr[nn]/100) * disco);\n       \t     \t\t\t}\n        \t    \t\tsisa = 100 - disco;\n        \t\t}else{\n        \t    \t\tsisa = flt(frm.doc.multilevel_discount_percentage);\n        \t\t}\n        \t\tfrm.set_value(\"additional_discount_percentage\", sisa);\n    \t\t}else{\n        \t\tfrm.set_value(\"additional_discount_percentage\", \"\");\n\t\t}\n\t},\n\tvalidate_return: function(frm){\n\t\tif(frm.doc.is_return == '1'){\n\t\t\tmsgprint(\"You can not make a sales return from here\");\n\t\t\tvalidated = false;\n\t\t}\n\t},\n\tvalidate_tt_advanced: function(frm){\n\t\tif(frm.doc.tt_advanced == '0' && frm.doc.type_of_invoice == 'Full Payment'){\n\t\t\tmsgprint(\"Apakah Invoice ini TT Advanced?\");\n\t\t}\n\t}\n});\nfrappe.ui.form.on(\"Sales Invoice DN\", {\n\tdelivery_note_remove: function(frm) {\n\t\ttotal_dn = 0.0;\n\t\t$.each(frm.doc.delivery, function(i, row) {\n\t\t\ttotal_dn += flt(row.net_total);\n\t\t})\n\t\tfrm.set_value(\"total_delivery_note\", total_dn);\n\t}\n});\ncur_frm.set_query(\"sales_order\", function(frm) {\n    return {\n        filters: [\n            ['docstatus', '=', '1'],\n\t    ['status', 'in', 'To Deliver and Bill, To Bill, To Deliver, Completed'],\n\t    ['customer', '=', cur_frm.doc.customer],\n\t    ['down_payment', '=', '']\n        ]\n    }\n});\ncur_frm.set_query(\"delivery_note\", function(frm) {\n    return {\n        filters: [\n            ['docstatus', '=', '1'],\n\t    ['customer', '=', cur_frm.doc.customer],\n\t    ['progress_payment', '=', '']\n        ]\n    }\n});\ncur_frm.fields_dict.write_off_account.get_query = function(doc) {\n\treturn{\n\t\tfilters:{\n\t\t\t'is_group': 0,\n\t\t\t'company': doc.company\n\t\t}\n\t}\n}", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Supplier Quotation", 
  "modified": "2017-08-14 16:11:48.420412", 
  "name": "Supplier Quotation-Client", 
  "script": "frappe.ui.form.on(\"Supplier Quotation\", \"refresh\", function() {\n  if(cur_frm.doc.docstatus == 0 || cur_frm.doc.__islocal){\n    cur_frm.add_custom_button(__('Request for Supplier Quotation'), function() {\n      erpnext.utils.map_current_doc({\n        method: \"preorder.preorder.doctype.request_for_supplier_quotation.request_for_supplier_quotation.make_supplier_quotation\",\n        source_doctype: \"Request for Supplier Quotation\",\n        target: cur_frm,\n        setters:  {\n\t  supplier: cur_frm.doc.supplier|| undefined,\n        },\n        get_query_filters: {\n      \t  docstatus: [\"!=\", 2]\n      }\n    })}, __(\"Get items from\"));\n    cur_frm.clear_custom_button()\n  };\n  if (cur_frm.doc.docstatus === 1){\n    cur_frm.clear_custom_button()\n  }\n})", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Purchase Order", 
  "modified": "2017-12-14 09:08:46.076843", 
  "name": "Purchase Order-Client", 
  "script": "frappe.ui.form.on(\"Purchase Order\",{\n\trefresh: function() {\n\t\tif(cur_frm.doc.docstatus == 0 || cur_frm.doc.__islocal){\n\t\t\tcur_frm.add_custom_button(__(\"Sales Order\"), function() {\n\t\t\t\terpnext.utils.map_current_doc({\n\t\t\t\t\tmethod: \"preorder.preorder.purchase.make_purchase_order\",\n\t\t\t\t\tsource_doctype: \"Sales Order\",\n\t\t\t\t\ttarget: cur_frm,\n\t\t\t\t\tsetters:  {\n\t\t\t\t\t\t//company: cur_frm.doc.company || undefined,\n\t\t\t\t\t\tcustomer: undefined,\n\t\t\t\t\t},\n\t\t\t\t\tget_query_filters: {\n\t\t\t\t\t\tdocstatus: 1,\n\t\t\t\t\t\tstatus: [\"!=\", \"Completed\"],\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}, __(\"Get items from\"));\n\t\t}\n\t\t//cur_frm.clear_custom_button();\n\t},\n\tvalidate: function(frm) {\n\t\t$.each(frm.doc.items, function(i, d) {\n\t\t\tif(d.amount == '0'){\n\t\t\t\tmsgprint(\"Item No.\"+d.idx+\", amount still empty\");\n\t\t\t\tvalidated = false;\n\t\t\t}\n\t\t})\n\t},\n\tmultilevel_discount_percentage: function(frm){\n    \t\tif(frm.doc.multilevel_discount_percentage) {\n        \t\tvar stringsearch = \"+\",str = frm.doc.multilevel_discount_percentage;\n        \t\tfor(var i=count=0; i<str.length; count+=+(stringsearch===str[i++]));\n        \t\tif(count >= 1){\n        \t    \t\tbanyak = count;\n\t\t\t\tvar parts = frm.doc.multilevel_discount_percentage;\n        \t    \t\tvar arr = parts.split('+');\n        \t    \t\tdisco = 100 - ((arr[0]/100) * 100);\n        \t    \t\tfor(nn=1; nn<=banyak; nn++){\n       \t         \t\t\tdisco = disco - ((arr[nn]/100) * disco);\n       \t     \t\t\t}\n        \t    \t\tsisa = 100 - disco;\n        \t\t}else{\n        \t    \t\tsisa = flt(frm.doc.multilevel_discount_percentage);\n        \t\t}\n        \t\tfrm.set_value(\"additional_discount_percentage\", sisa);\n    \t\t}else{\n        \t\tfrm.set_value(\"additional_discount_percentage\", \"\");\n    \t\t}\n\t},\n})\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Order", 
  "modified": "2017-12-15 14:15:07.489756", 
  "name": "Sales Order-Client", 
  "script": "frappe.ui.form.on(\"Sales Order\", {\n\trefresh: function(frm) {\n\t\tif(cur_frm.doc.docstatus == 0 || cur_frm.doc.__islocal){\n\t\t\tcur_frm.add_custom_button(__(\"Sales Quotation\"), function() {\n\t\t\t\terpnext.utils.map_current_doc({\n\t\t\t\t\tmethod: \"preorder.preorder.selling.make_sales_order\",\n\t\t\t\t\tsource_doctype: \"Quotation\",\n\t\t\t\t\ttarget: cur_frm,\n\t\t\t\t\tsetters:  {\n\t\t\t\t\t\tcustomer: frm.doc.customer || undefined,\n\t\t\t\t\t},\n\t\t\t\t\tget_query_filters: {\n\t\t\t\t\t\tcompany: frm.doc.company,\n\t\t\t\t\t\tdocstatus: 1,\n\t\t\t\t\t\tso_status: [\"!=\", \"Completed\"],\n\t\t\t\t\t\tstatus: [\"!=\", \"Lost\"],\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}, __(\"Get items from\"));\n\t\t\tfrm.clear_custom_button();\n\t\t};\n\t\t//frm.clear_custom_button();\n\t\tfrm.events.rate_quotation(frm);\n\t},\n\trate_quotation: function(frm){\n\t\tif(cur_frm.doc.docstatus == 0){\n\t\t\tvar tbl = frm.doc.items || [];\n\t\t\tvar i = tbl.length;\n\t\t\twhile (i--) {\n\t\t\t\tif(frm.doc.items[i].quotation_rate == 0){\n            \t\t\t\tfrm.doc.items[i].quotation_rate = frm.doc.items[i].rate;\n            \t\t\t\tfrm.refresh_field(\"items\");\n\t\t\t\t}\n    \t\t\t}\n\t\t}\n\t},\n\treset_rate: function(frm) {\n\t\t$.each(frm.doc.items, function(i, row) {\n\t\t\tif(row.quotation_rate != 0){\n\t\t\t\trow.rate = row.quotation_rate;\n\t\t\t\trow.base_rate = row.rate;\n\t\t\t\trow.amount = flt(row.qty) * flt(row.rate);\n\t\t\t\trow.base_amount = row.amount;\n\t\t\t}\n\t\t})\n\t\tfrm.refresh_field(\"items\");\n\t\tfrm.set_value(\"count_reset_rate\", \"1\");\n\t},\n\tvalidate: function(frm){\n/*\n\t\tif(frm.doc.customer_group == \"Reseller\" && !frm.doc.proforma_invoice_no){\n\t\t\tmsgprint(\"<b>Proforma Invoice No</b> is mandatory\");\n\t\t\tvalidated = false;\n\t\t}\n*/\n\t\tfrm.events.check_reset_rate(frm);\n\t},\n\tcheck_reset_rate: function(frm){\n\t\tif(flt(frm.doc.count_reset_rate) == 0){\n\t\t\tmsgprint(\"Please click <b>reset rate</b>\");\n\t\t\tvalidated = false;\n\t\t}\n\t},\n\tmultilevel_discount_percentage: function(frm){\n    \t\tif(frm.doc.multilevel_discount_percentage) {\n        \t\tvar stringsearch = \"+\",str = frm.doc.multilevel_discount_percentage;\n        \t\tfor(var i=count=0; i<str.length; count+=+(stringsearch===str[i++]));\n        \t\tif(count >= 1){\n        \t    \t\tbanyak = count;\n\t\t\t\tvar parts = frm.doc.multilevel_discount_percentage;\n        \t    \t\tvar arr = parts.split('+');\n        \t    \t\tdisco = 100 - ((arr[0]/100) * 100);\n        \t    \t\tfor(nn=1; nn<=banyak; nn++){\n       \t         \t\t\tdisco = disco - ((arr[nn]/100) * disco);\n       \t     \t\t\t}\n        \t    \t\tsisa = 100 - disco;\n        \t\t}else{\n        \t    \t\tsisa = flt(frm.doc.multilevel_discount_percentage);\n        \t\t}\n        \t\tfrm.set_value(\"additional_discount_percentage\", sisa);\n    \t\t}else{\n        \t\tfrm.set_value(\"additional_discount_percentage\", \"\");\n    \t\t}\n\t},\n})\n/*\nvar calculate_multilevel_discount = function(frm) {\n    var diskon1 = frm.doc.discount_1;\n    var diskon2 = frm.doc.discount_2;\n    var diskon3 = frm.doc.discount_3;\n    var diskon1_amt = ((100 - diskon1)/100) * 100;\n    var diskon2_amt = ((100 - diskon2)/100) * diskon1_amt;\n    var diskon3_amt = ((100 - diskon3)/100) * diskon2_amt;\n    var total_diskon = 100 - diskon3_amt;\n    var diskon1_amount = (diskon1/100) * frm.doc.total;\n    var amount_after1 = frm.doc.total - diskon1_amount;\n    var diskon2_amount = (diskon2/100) * amount_after1;\n    var amount_after2 = amount_after1 - diskon2_amount;\n    var diskon3_amount = (diskon3/100) * amount_after2;\n    var amount_after3 = amount_after2 - diskon3_amount;\n    frm.set_value(\"discount_1_amount\", diskon1_amount);\n    frm.set_value(\"amount_after_discount_1\", amount_after1);\n    frm.set_value(\"discount_2_amount\", diskon2_amount);\n    frm.set_value(\"amount_after_discount_2\", amount_after2);\n    frm.set_value(\"discount_3_amount\", diskon3_amount);\n    frm.set_value(\"amount_after_discount_3\", amount_after3);\n    frm.set_value(\"additional_discount_percentage\", total_diskon);\n    frm.set_value(\"total_discount_percentage\", total_diskon);\n    var aa = (total_diskon/100) * frm.doc.total;\n    frm.set_value(\"total_discount_amount\", aa);\n}\nfrappe.ui.form.on(\"Sales Order\", \"discount_1\", function(frm) {\n    calculate_multilevel_discount(frm);\n})\nfrappe.ui.form.on(\"Sales Order\", \"discount_2\", function(frm) {\n    calculate_multilevel_discount(frm);\n})\nfrappe.ui.form.on(\"Sales Order\", \"discount_3\", function(frm) {\n    calculate_multilevel_discount(frm);\n})\nfrappe.ui.form.on(\"Sales Order\", \"net_total\", function(frm) {\n    calculate_multilevel_discount(frm);\n})\n\nfrappe.ui.form.on(\"Sales Order\", \"validate\", function(frm) {\n    calculate_multilevel_discount(frm);\n    beda_diskon_amount(frm);\n})\nvar beda_diskon_amount = function(frm){\n    var total_diskon_persen = frm.doc.total_discount_percentage;\n    var total_diskon_amount = (total_diskon_persen/100) * frm.doc.total;\n    if(total_diskon_amount != frm.doc.total_discount_amount){\n\tfrm.set_value(\"total_discount_percentage\", \"0\");\n\tfrm.set_value(\"discount_amount\", frm.doc.total_discount_amount);\n    }\n}\nfrappe.ui.form.on(\"Sales Order\", \"total_discount_amount\", function(frm) {\n    beda_diskon_amount(frm);\n})\n*/", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Delivery Note", 
  "modified": "2018-01-08 14:51:53.391261", 
  "name": "Delivery Note-Client", 
  "script": "frappe.ui.form.on(\"Delivery Note\",{\n\trefresh: function(frm) {\n\t\tif(frm.doc.docstatus == 1) {\n\t\t\tcur_frm.add_custom_button(__('Journal Entry'), cur_frm.cscript['Journal Entry'], __(\"Make\"));\n\t\t\tcur_frm.page.set_inner_btn_group_as_primary(__(\"Make\"));\n\t\t}\n\t},\n\tmultilevel_discount_percentage: function(frm){\n    \t\tif(frm.doc.multilevel_discount_percentage) {\n        \t\tvar stringsearch = \"+\",str = frm.doc.multilevel_discount_percentage;\n        \t\tfor(var i=count=0; i<str.length; count+=+(stringsearch===str[i++]));\n        \t\tif(count >= 1){\n        \t    \t\tbanyak = count;\n\t\t\t\tvar parts = frm.doc.multilevel_discount_percentage;\n        \t    \t\tvar arr = parts.split('+');\n        \t    \t\tdisco = 100 - ((arr[0]/100) * 100);\n        \t    \t\tfor(nn=1; nn<=banyak; nn++){\n       \t         \t\t\tdisco = disco - ((arr[nn]/100) * disco);\n       \t     \t\t\t}\n        \t    \t\tsisa = 100 - disco;\n        \t\t}else{\n        \t    \t\tsisa = flt(frm.doc.multilevel_discount_percentage);\n        \t\t}\n        \t\tfrm.set_value(\"additional_discount_percentage\", sisa);\n    \t\t}else{\n        \t\tfrm.set_value(\"additional_discount_percentage\", \"\");\n    \t\t}\n\t},\n\tvalidate: function(frm){\n\t\tif(frm.doc.is_return == '1'){\n\t\t\tmsgprint(\"You can not make a sales return from here\");\n\t\t\tvalidated = false;\n\t\t}\n\t},\n})\ncur_frm.cscript['Journal Entry'] = function() {\n\tfrappe.model.open_mapped_doc({\n\t\tmethod: \"preorder.preorder.lemparan.make_journal_entry\",\n\t\tfrm: cur_frm\n\t})\n}", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Journal Entry", 
  "modified": "2018-04-24 17:17:04.380762", 
  "name": "Journal Entry-Client", 
  "script": "frappe.ui.form.on(\"Journal Entry\", {\n\tonload: function(frm){\n\t//\tfrm.set_value(\"count_refresh\", \"1\");\n\t},\n\trefresh: function(frm){\n\t\tif(frm.doc.__islocal && frm.doc.reversing_entry == 0){\n\t\t\tfrm.set_value(\"delivery_note\", \"\");\n\t\t\tfrm.set_value(\"rss_sales_invoice\", \"\");\n\t\t\tvar url = window.location.href.split(\"?\");\n\t\t\tvar doct = url[1].split(\"=\");\n\t\t\tif(doct[0] == \"delivery_note\"){\n\t\t\t\tfrm.set_value(\"rss_sales_invoice\", \"\");\n\t\t\t\tfrm.set_value(\"delivery_note\", doct[1]);\n\t\t\t}else if(doct[0] == \"rss_sales_invoice\"){\n\t\t\t\tfrm.set_value(\"delivery_note\", \"\");\n\t\t\t\tfrm.set_value(\"rss_sales_invoice\", doct[1]);\n\t\t\t}else{\n\t\t\t\tfrm.set_value(\"delivery_note\", \"\");\n\t\t\t\tfrm.set_value(\"rss_sales_invoice\", \"\");\n\t\t\t}\n\t\t}\n\n\t//\tfrm.set_value(\"user_remark\", doct[0]);\n\t//\tfrappe.ui.toolbar.clear_cache()\n\t\tif(frm.doc.docstatus == 1) {\n\t\t\tcur_frm.add_custom_button(__('Reversing Entry'), cur_frm.cscript['Reversing Entry'], __(\"Make\"));\n\t\t\tcur_frm.page.set_inner_btn_group_as_primary(__(\"Make\"));\n\t\t}\n\t},\n\tget_amount: function(frm){\n\t\tfrm.clear_table(\"accounts\");\n\t\tif(!frm.doc.delivery_note) return;\n\t\treturn frappe.call({\n\t\t\tmethod: 'preorder.preorder.lemparan.get_amount_dn',\n\t\t\targs: {\n\t\t\t\tdn: frm.doc.delivery_note\n\t\t\t},\n\t\t\tcallback: function(r, rt) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\t$.each(r.message, function(i, d) {\n\t\t\t\t\t\tvar c = frm.add_child(\"accounts\");\n\t\t\t\t\t\tc.debit_in_account_currency = d.debit;\n\t\t\t\t\t\tc.credit_in_account_currency = d.credit;\n\t\t\t\t\t})\n\t\t\t\t\tfrm.refresh_fields();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\tget_amount_si: function(frm){\n\t\tfrm.clear_table(\"accounts\");\n\t\tif(!frm.doc.rss_sales_invoice) return;\n\t\treturn frappe.call({\n\t\t\tmethod: 'preorder.preorder.lemparan.get_amount_si',\n\t\t\targs: {\n\t\t\t\tsi: frm.doc.rss_sales_invoice\n\t\t\t},\n\t\t\tcallback: function(r, rt) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\t$.each(r.message, function(i, d) {\n\t\t\t\t\t\tvar c = frm.add_child(\"accounts\");\n\t\t\t\t\t\tc.debit_in_account_currency = d.debit;\n\t\t\t\t\t\tc.credit_in_account_currency = d.credit;\n\t\t\t\t\t})\n\t\t\t\t\tfrm.refresh_fields();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n})\ncur_frm.cscript['Reversing Entry'] = function() {\n\tfrappe.model.open_mapped_doc({\n\t\tmethod: \"preorder.preorder.lemparan.make_reverse_journal\",\n\t\tfrm: cur_frm\n\t})\n}\nfrappe.ui.form.on('Journal Entry Account', {\n\tparty: function(frm, cdt, cdn){\n\t\tvar d = locals[cdt][cdn];\n\t\tif(d.party_type == 'Customer'){\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Customer\",\n\t\t\t\t\tfilters:{\n\t\t\t\t\t\tname: d.party\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcallback: function (data) {\n\t\t\t\t\tif(data.message){\n\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"party_name\", data.message.customer_name);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"party_name\", \"\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\tif(d.party_type == 'Supplier'){\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Supplier\",\n\t\t\t\t\tfilters:{\n\t\t\t\t\t\tname: d.party\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcallback: function (data) {\n\t\t\t\t\tif(data.message){\n\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"party_name\", data.message.supplier_name);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"party_name\", \"\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\n\t\t}\n\t}\n})", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Item", 
  "modified": "2017-10-24 15:32:34.412374", 
  "name": "Item-Client", 
  "script": "frappe.ui.form.on('Item', {\n\tvalidate: function(frm){\n\t\tif(frm.doc.item_group == \"Products\" && frm.doc.is_stock_item == \"0\"){\n\t\t\tmsgprint(\"Item Group Products must maintain stock\");\n\t\t\tvalidated = false;\n\t\t}else if(frm.doc.item_group != \"Products\" && frm.doc.is_stock_item == \"1\"){\n\t\t\tmsgprint(\"Please uncheck maintain stock for this Item Group\");\n\t\t\tvalidated = false;\n\t\t}\n\t}\n});\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Product Bundle", 
  "modified": "2017-12-07 09:07:59.461185", 
  "name": "Product Bundle-Client", 
  "script": "cur_frm.set_query(\"new_item_code\",  function (frm) {\n\treturn {\n\t\tfilters: {\n\t\t\t'item_group': \"Bundle\"\n\t\t},\n\t}\n});\ncur_frm.set_query(\"item_code\", \"items\",  function (doc, cdt, cdn) {\n\tvar c_doc= locals[cdt][cdn];\n\treturn {\n\t\tfilters: {\n\t\t\t'item_group': [\"!=\", \"Bundle\"]\n\t\t}\n\t}\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Stock Entry", 
  "modified": "2018-01-08 17:26:32.139897", 
  "name": "Stock Entry-Client", 
  "script": "frappe.ui.form.on(\"Stock Entry\", {\n\trefresh: function(frm){\n\t\tif(frm.doc.docstatus == 1 && frm.doc.purpose == \"Material Issue\") {\n\t\t\tcur_frm.add_custom_button(__('Debit Note'), cur_frm.cscript['Make Debit Note'], __(\"Make\"));\n\t\t\tcur_frm.page.set_inner_btn_group_as_primary(__(\"Make\"));\n\t\t}\n\t\tif(frm.doc.docstatus == 1 && frm.doc.purpose == \"Material Receipt\"){\n\t\t\tcur_frm.add_custom_button(__('Credit Note'), cur_frm.cscript['Make Credit Note'], __(\"Make\"));\n\t\t\tcur_frm.page.set_inner_btn_group_as_primary(__(\"Make\"));\n\t\t}\n\t},\n\tget_inquiry_items: function(frm){\n\t\terpnext.utils.map_current_doc({\n\t\t\tmethod: \"preorder.preorder.lemparan.get_inquiry_items\",\n\t\t\tsource_name: frm.doc.sales_order,\n\t\t});\n\t},\n\tvalidate: function(frm){\n\t\tif(frm.doc.purpose == \"Material Issue\" && frm.doc.issue_type == \"\"){\n\t\t\tmsgprint(\"For <b>Material Issue</b> you must fill in <b>Issue Type</b>\");\n\t\t\tvalidated = false;\n\t\t}\n\t\tif(frm.doc.purpose == \"Material Receipt\" && frm.doc.receipt_type == \"\"){\n\t\t\tmsgprint(\"For <b>Material Receipt</b> you must fill in <b>Receipt Type</b>\");\n\t\t\tvalidated = false;\n\t\t}\n\t\tif(frm.doc.purpose == \"Material Issue\" && frm.doc.issue_type != \"\"){\n\t\t\tfrm.set_value(\"receipt_type\", \"\");\n\t\t}\n\t\tif(frm.doc.purpose == \"Material Receipt\" && frm.doc.receipt_type != \"\"){\n\t\t\tfrm.set_value(\"issue_type\", \"\");\n\t\t}\n\t},\n})\ncur_frm.set_query(\"inquiry\", function(frm) {\n\treturn {\n        \tfilters: {\n\t\t\t'docstatus': '1',\n\t\t\t'inquiry_type': [\"in\", \"Request Project, Request Service, Request Project BST\"]\n        \t}\n\t}\n});\ncur_frm.set_query(\"sales_order\", function(frm) {\n\treturn {\n\t\tquery: \"preorder.preorder.selling.get_sales_order\",\n        \tfilters: {\n\t\t\t'docstatus': '1',\n\t\t\t'inquiry': cur_frm.doc.inquiry\n        \t}\n\t}\n});\ncur_frm.cscript['Make Debit Note'] = function() {\n\tfrappe.model.open_mapped_doc({\n\t\tmethod: \"preorder.preorder.lemparan.make_journal_entry_3\",\n\t\tfrm: cur_frm\n\t})\n};\ncur_frm.cscript['Make Credit Note'] = function() {\n\tfrappe.model.open_mapped_doc({\n\t\tmethod: \"preorder.preorder.lemparan.make_journal_entry_3\",\n\t\tfrm: cur_frm\n\t})\n}", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Purchase Receipt", 
  "modified": "2018-01-08 14:58:22.169296", 
  "name": "Purchase Receipt-Client", 
  "script": "frappe.ui.form.on(\"Purchase Receipt\",{\n\tmultilevel_discount_percentage: function(frm){\n    \t\tif(frm.doc.multilevel_discount_percentage) {\n        \t\tvar stringsearch = \"+\",str = frm.doc.multilevel_discount_percentage;\n        \t\tfor(var i=count=0; i<str.length; count+=+(stringsearch===str[i++]));\n        \t\tif(count >= 1){\n        \t    \t\tbanyak = count;\n\t\t\t\tvar parts = frm.doc.multilevel_discount_percentage;\n        \t    \t\tvar arr = parts.split('+');\n        \t    \t\tdisco = 100 - ((arr[0]/100) * 100);\n        \t    \t\tfor(nn=1; nn<=banyak; nn++){\n       \t         \t\t\tdisco = disco - ((arr[nn]/100) * disco);\n       \t     \t\t\t}\n        \t    \t\tsisa = 100 - disco;\n        \t\t}else{\n        \t    \t\tsisa = flt(frm.doc.multilevel_discount_percentage);\n        \t\t}\n        \t\tfrm.set_value(\"additional_discount_percentage\", sisa);\n    \t\t}else{\n        \t\tfrm.set_value(\"additional_discount_percentage\", \"\");\n    \t\t}\n\t},\n\tvalidate: function(frm){\n\t\tif(frm.doc.is_return == '1'){\n\t\t\tmsgprint(\"You can not make a purchase return from here\");\n\t\t\tvalidated = false;\n\t\t}\n\t},\n})", 
  "script_type": "Client"
 }
]